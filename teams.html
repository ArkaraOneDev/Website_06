<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tim Arkastone | Personel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .text-arkara-orange { color: #E3722E; }
        .bg-arkara-orange { background-color: #E3722E; }
        
        /* Animasi Transisi Kartu */
        .team-card {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Animasi Masuk */
        .animate-item {
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            transition: opacity 0.8s cubic-bezier(0.22, 1, 0.36, 1), 
                        transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            will-change: transform, opacity;
        }

        .animate-item.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
        }

        /* Optimasi untuk layar sentuh (mobile) di mana hover tidak ada */
        @media (max-width: 768px) {
            .mobile-info-reveal {
                transform: translateY(0) !important;
                background: linear-gradient(to top, rgba(0,0,0,0.95) 40%, rgba(0,0,0,0.4) 70%, transparent 100%) !important;
            }
            .mobile-opacity-show {
                opacity: 1 !important;
            }
        }
    </style>
</head>
<body class="bg-[#E2E8F0] p-4 md:p-8">

    <div class="w-full mx-auto">
        <!-- Bagian Grid menggunakan w-full untuk memaksimalkan lebar desktop -->
        <div id="teamsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 md:gap-6">
            <!-- Grid diisi secara dinamis -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const SUPABASE_URL = 'https://dqfithvufqewtchicrgw.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_wp6piNTxSLOXT-ezmfnhaQ_cFKP13k7';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function fetchTeams() {
            const grid = document.getElementById('teamsGrid');

            try {
                const { data: profiles, error } = await _supabase
                    .from('profiles')
                    .select('*')
                    .order('nama', { ascending: true });

                if (error) throw error;
                
                if (!profiles || profiles.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-20">
                            <p class="text-gray-500 font-medium text-sm md:text-base">Belum ada anggota tim yang terdaftar.</p>
                        </div>`;
                    return;
                }

                renderTeamCards(profiles, grid);

            } catch (err) {
                console.error('Error fetching teams:', err);
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="inline-block px-4 py-2 bg-red-50 rounded-lg border border-red-100">
                            <p class="text-red-500 text-[10px] md:text-xs uppercase tracking-widest font-black">Koneksi Database Terputus</p>
                        </div>
                    </div>`;
            }
        }

        function renderTeamCards(profiles, container) {
            container.innerHTML = profiles.map((user, index) => {
                const isOnline = user.status === 'Online';
                const statusBg = isOnline ? 'bg-green-500' : 'bg-slate-400';
                
                const cleanPhone = user.phone ? user.phone.replace(/\D/g, '') : '';
                let waNumber = cleanPhone;
                if (waNumber.startsWith('0')) waNumber = '62' + waNumber.slice(1);
                const waLink = waNumber ? `https://wa.me/${waNumber}` : '#';

                return `
                    <div class="team-card animate-item group relative aspect-[3/4.2] rounded-2xl md:rounded-[2rem] overflow-hidden bg-gray-900 shadow-md md:shadow-lg" 
                         data-username="${user.username}"
                         style="transition-delay: ${index * 50}ms">
                        
                        <!-- Foto Profil -->
                        <img src="${user.photo_url || 'https://via.placeholder.com/400x600?text=No+Photo'}" 
                             alt="${user.nama}" 
                             class="absolute inset-0 w-full h-full object-cover transition-all duration-700 ${isOnline ? '' : 'grayscale'} group-hover:grayscale-0 group-hover:scale-110"
                             onerror="this.src='https://via.placeholder.com/400x600?text=User'">

                        <!-- Overlay Gradasi -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/95 via-black/20 to-transparent opacity-80 z-10"></div>

                        <!-- Status Badge -->
                        <div class="absolute top-3 right-3 md:top-4 md:right-4 z-30 flex items-center bg-black/40 backdrop-blur-md px-2 py-0.5 md:px-2.5 md:py-1 rounded-full border border-white/10">
                            <span class="relative flex h-1.5 w-1.5 md:h-2 md:w-2 mr-1.5 md:mr-2">
                                ${isOnline ? `<span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>` : ''}
                                <span class="relative inline-flex rounded-full h-1.5 w-1.5 md:h-2 md:w-2 ${statusBg}"></span>
                            </span>
                            <span class="text-[7px] md:text-[8px] font-black uppercase tracking-widest text-white/90">
                                ${user.status || 'Offline'}
                            </span>
                        </div>

                        <!-- Info Konten -->
                        <div class="absolute inset-x-0 bottom-0 p-3 md:p-5 z-20 transition-all duration-500 ease-out transform translate-y-[60px] md:translate-y-[80px] group-hover:translate-y-0 mobile-info-reveal">
                            
                            <div class="transition-transform duration-500">
                                <h3 class="text-white text-sm md:text-lg font-bold leading-tight drop-shadow-lg truncate">
                                    ${user.nama || user.username || 'Tanpa Nama'}
                                </h3>
                                <p class="text-arkara-orange text-[9px] md:text-[10px] font-black uppercase tracking-wider md:tracking-[0.15em] mt-0.5 md:mt-1 drop-shadow-lg line-clamp-2 min-h-[2.4em] leading-tight">
                                    ${user.jabatan || 'Anggota Tim'}
                                </p>
                            </div>

                            <!-- Detail Kontak -->
                            <div class="mt-3 md:mt-4 space-y-2 md:space-y-3 opacity-0 group-hover:opacity-100 transition-all duration-500 delay-100 mobile-opacity-show">
                                
                                <a href="mailto:${user.email || ''}" class="flex items-center text-white/70 hover:text-white transition-colors group/link">
                                    <div class="p-1 md:p-1.5 bg-white/10 rounded-md md:rounded-lg mr-2 md:mr-2.5 group-hover/link:bg-blue-500/20 transition-colors">
                                        <svg class="w-2.5 h-2.5 md:w-3 md:h-3 text-white/50 group-hover/link:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <span class="text-[9px] md:text-[10px] font-medium truncate">${user.email || '-'}</span>
                                </a>

                                <a href="${waLink}" target="_blank" class="flex items-center text-white/70 hover:text-white transition-colors group/link">
                                    <div class="p-1 md:p-1.5 bg-white/10 rounded-md md:rounded-lg mr-2 md:mr-2.5 group-hover/link:bg-green-500/20 transition-colors">
                                        <svg class="w-2.5 h-2.5 md:w-3 md:h-3 text-white/50 group-hover/link:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <span class="text-[9px] md:text-[10px] font-medium">${user.phone || '-'}</span>
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            setTimeout(() => {
                const items = container.querySelectorAll('.animate-item');
                items.forEach(item => item.classList.add('show'));
            }, 50);
        }

        function initRealtimeSubscription() {
            _supabase
                .channel('realtime-profiles')
                .on('postgres_changes', { 
                    event: '*', 
                    schema: 'public', 
                    table: 'profiles' 
                }, () => fetchTeams())
                .subscribe();
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchTeams();
            initRealtimeSubscription();
        });
    </script>
</body>
</html>